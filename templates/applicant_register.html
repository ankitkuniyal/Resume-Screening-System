{% extends 'base.html' %}
{% block title %}Applicant Registration Form{% endblock %}
{% block styles %}
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap">
<link rel="stylesheet" href="../static/css/applicant_register.css">
{% endblock %}

{% block content %}
<div class="container">
    <header>Applicant Registration</header>
    
    <div class="form-outer">
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-step active" data-step="1">
                1
                <span class="progress-label">Personal Details</span>
            </div>
            <div class="progress-step" data-step="2">
                2
                <span class="progress-label">Education</span>
            </div>
            <div class="progress-step" data-step="3">
                3
                <span class="progress-label">Experience</span>
            </div>
            <div class="progress-step" data-step="4">
                4
                <span class="progress-label">Skills</span>
            </div>
            <div class="progress-step" data-step="5">
                5
                <span class="progress-label">Login Info</span>
            </div>
        </div>
        
        <form action="{{ url_for('register_applicant') }}" method="POST" id="registration-form">
            <div class="form-content">
                <!-- Page 1: Personal Details -->
                <div class="page active" data-page="1">
                    <div class="title">Personal Details</div>
                    
                    <div class="fields-grid">
                        <div class="field">
                            <label for="name" class="label">Full Name</label>
                            <input type="text" name="name" id="name" required placeholder="Enter your full name" />
                        </div>
                        
                        <div class="field">
                            <label for="email" class="label">Email Address</label>
                            <input type="email" name="email" id="email" required placeholder="Enter your email address" />
                        </div>
                    </div>
                    
                    <div class="fields-grid">
                        <div class="field">
                            <label for="phone" class="label">Mobile Number</label>
                            <input type="tel" name="phone" id="phone" required placeholder="Enter your mobile number" pattern="[0-9]+" title="Only numbers are allowed" />
                        </div>
                        
                        <div class="field">
                            <label for="dob" class="label">Date of Birth</label>
                            <input type="date" name="dob" id="dob" required max="{{ max_dob }}" />
                        </div>
                    </div>
                    
                    <div class="fields-grid">
                        <div class="field">
                            <label for="gender" class="label">Gender</label>
                            <select name="gender" id="gender" required>
                                <option value="" disabled selected>Select gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="field">
                            <label for="address" class="label">Address</label>
                            <input type="text" name="address" id="address" required placeholder="Enter your full address" />
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="button" class="btn-next">Next Step</button>
                    </div>
                </div>
                
                <!-- Page 2: Educational Background -->
                <div class="page" data-page="2">
                    <div class="title">Educational Background</div>
                    
                    <div class="fields-grid">
                        <div class="field">
                            <label for="highest_qualification" class="label">Highest Qualification</label>
                            <select name="highest_qualification" id="highest_qualification" required>
                                <option value="" disabled selected>Select your qualification</option>
                                <option value="High School">High School</option>
                                <option value="Diploma">Diploma</option>
                                <option value="Bachelor's">Bachelor's</option>
                                <option value="Master's">Master's</option>
                                <option value="PhD">PhD</option>
                            </select>
                        </div>
                        
                        <div class="field">
                            <label for="field_of_study" class="label">Field Of Study</label>
                            <select name="field_of_study" id="field_of_study" required>
                                <option value="" disabled selected>Select your field of study</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Business Administration">Business Administration</option>
                                <option value="Medicine">Medicine</option>
                                <option value="Law">Law</option>
                                <option value="Arts">Arts</option>
                                <option value="Education">Education</option>
                                <option value="Science">Science</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="button" class="btn-prev">Previous</button>
                        <button type="button" class="btn-next">Next Step</button>
                    </div>
                </div>
                
                <!-- Page 3: Work Experience -->
                <div class="page" data-page="3">
                    <div class="title">Work Experience</div>
                    
                    <div class="field">
                        <label for="experience_years" class="label">Years of Experience</label>
                        <select name="experience_years" id="experience_years" required>
                            <option value="" disabled selected>Select Years of Experience</option>
                            <option value="0">0 (Fresher)</option>
                            <option value="1">1 Year</option>
                            <option value="2">2 Years</option>
                            <option value="3">3 Years</option>
                            <option value="4">4 Years</option>
                            <option value="5">5+ Years</option>
                        </select>
                    </div>
                    
                    <div class="field">
                        <div class="label">Upload Resume</div>
                        <input type="text" name="resume_link" id="resume_link" required placeholder="Enter Google Drive link" title="Please enter a valid Google Drive link" class="styled-input" />
                        <small style="display: block; margin-top: 5px; color: #666;">Only Google Drive links are allowed (e.g., https://drive.google.com/...)</small>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="button" class="btn-prev">Previous</button>
                        <button type="button" class="btn-next">Next Step</button>
                    </div>
                </div>
                
                <!-- Page 4: Skills and Qualifications with Search -->
                <div class="page" data-page="4">
                    <div class="title">Skills & Qualifications</div>
                    
                    <div class="field" id="skills-section">
                        <div class="search-container">
                            <input type="text" id="skill-search" class="search-input" placeholder="Search for skills...">
                        </div>
                        <div class="label">Select Your Skills</div>
                        <div class="checkbox-group" id="skills-checkbox-group">
                            {% for skill in skills %}
                                <label class="checkbox-label skill-item" data-skill="{{ skill.skill_name.lower() }}">
                                    <input type="checkbox" name="skills" value="{{ skill.id }}" /> 
                                    {{ skill.skill_name }}
                                </label>
                            {% endfor %}
                        </div>
                        <div id="no-results" class="no-results" style="display: none;">No matching skills found</div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="button" class="btn-prev">Previous</button>
                        <button type="button" class="btn-next">Next Step</button>
                    </div>
                </div>
                
                <!-- Page 5: Login Information -->
                <div class="page" data-page="5">
                    <div class="title">Login Information</div>
                    
                    <div class="fields-grid">
                        <div class="field">
                            <label for="login_email" class="label">Email Address</label>
                            <input type="email" name="login_email" id="login_email" required placeholder="Enter your email address" />
                            <small class="hint">This will be used for login.</small>
                        </div>
                    </div>
                    
                    <div class="fields-grid">
                        <div class="field">
                            <label for="password" class="label">Password</label>
                            <input type="password" name="password" id="password" required placeholder="Create a strong password" />
                            <div class="password-requirements">
                                Password must be at least 8 characters long.
                            </div>
                        </div>
                        
                        <div class="field">
                            <label for="confirm_password" class="label">Confirm Password</label>
                            <input type="password" name="confirm_password" id="confirm_password" required placeholder="Confirm your password" />
                            <div id="password-match-error" class="error-message"></div>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="button" class="btn-prev">Previous</button>
                        <button type="submit" class="submit">Register</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Email sync between contact email and login email
    const contactEmail = document.getElementById('email');
    const loginEmail = document.getElementById('login_email');

    const syncEmails = (source, target) => {
        source.addEventListener('input', () => {
            target.value = source.value;
        });
    };

    syncEmails(contactEmail, loginEmail);
    syncEmails(loginEmail, contactEmail);

    // Form navigation
    const pages = document.querySelectorAll('.page');
    const nextBtns = document.querySelectorAll('.btn-next');
    const prevBtns = document.querySelectorAll('.btn-prev');
    const progressSteps = document.querySelectorAll('.progress-step');
    
    // Next button event listeners
    nextBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const currentPage = document.querySelector('.page.active');
            const currentStepNum = parseInt(currentPage.dataset.page);
            const nextStepNum = currentStepNum + 1;
            
            // Validate current page fields
            const inputs = currentPage.querySelectorAll('input[required], select[required]');
            let isValid = true;
            
            inputs.forEach(input => {
                if (!input.value) {
                    input.classList.add('error');
                    isValid = false;
                } else {
                    input.classList.remove('error');
                }
            });
            
            if (!isValid) {
                const firstError = currentPage.querySelector('.error');
                if (firstError) {
                    firstError.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }
                return;
            }
            
            // Proceed to next page
            currentPage.classList.remove('active');
            const nextPage = document.querySelector(`.page[data-page="${nextStepNum}"]`);
            nextPage.classList.add('active');
            
            // Update progress bar
            progressSteps[currentStepNum - 1].classList.add('completed');
            progressSteps[nextStepNum - 1].classList.add('active');
        });
    });
    
    // Previous button event listeners
    prevBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const currentPage = document.querySelector('.page.active');
            const currentStepNum = parseInt(currentPage.dataset.page);
            const prevStepNum = currentStepNum - 1;
            
            currentPage.classList.remove('active');
            const prevPage = document.querySelector(`.page[data-page="${prevStepNum}"]`);
            prevPage.classList.add('active');
            
            progressSteps[currentStepNum - 1].classList.remove('active');
            progressSteps[prevStepNum - 1].classList.remove('completed');
            progressSteps[prevStepNum - 1].classList.add('active');
        });
    });
    
    // Form validation on submit
    const form = document.getElementById('registration-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                }
            });
            
            const password = document.getElementById('password');
            const confirmPassword = document.getElementById('confirm_password');
            const errorElement = document.getElementById('password-match-error');
            
            if (password.value !== confirmPassword.value) {
                password.classList.add('error');
                confirmPassword.classList.add('error');
                errorElement.textContent = 'Passwords do not match!';
                errorElement.style.display = 'block';
                isValid = false;
            } else {
                password.classList.remove('error');
                confirmPassword.classList.remove('error');
                errorElement.style.display = 'none';
            }
            
            if (!isValid) {
                e.preventDefault();
                const firstError = form.querySelector('.error');
                if (firstError) {
                    firstError.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }
            }
        });
    }

    // Skill search functionality
    const skillSearch = document.getElementById('skill-search');
    const skillItems = document.querySelectorAll('.skill-item');
    const skillsCheckboxGroup = document.getElementById('skills-checkbox-group');
    const noResultsMessage = document.getElementById('no-results');

    skillSearch.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        let hasMatches = false;
        let visibleCount = 0;
        
        skillItems.forEach(item => {
            const skillName = item.getAttribute('data-skill');
            const shouldShow = searchTerm === '' || skillName.includes(searchTerm);
            
            item.style.display = shouldShow ? 'block' : 'none';
            
            if (shouldShow) {
                hasMatches = true;
                visibleCount++;
            }
        });
        
        // Show/hide no results message
        if (searchTerm && !hasMatches) {
            noResultsMessage.style.display = 'block';
            skillsCheckboxGroup.style.display = 'none';
        } else {
            noResultsMessage.style.display = 'none';
            skillsCheckboxGroup.style.display = 'block';
        }
        
        // Auto-scroll to first visible item if searching
        if (searchTerm && visibleCount > 0) {
            const firstVisible = document.querySelector('.skill-item[style="display: block;"]');
            if (firstVisible) {
                firstVisible.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest' 
                });
            }
        }
    });

    // Clear search when leaving page 4
    const pagesContainer = document.querySelector('.form-content');
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
                const activePage = document.querySelector('.page.active');
                if (activePage && activePage.dataset.page !== '4') {
                    skillSearch.value = '';
                    skillSearch.dispatchEvent(new Event('input'));
                }
            }
        });
    });

    observer.observe(pagesContainer, {
        attributes: true,
        attributeFilter: ['class']
    });
});
</script>
{% endblock %}